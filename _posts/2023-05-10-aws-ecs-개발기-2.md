---
layout: post
title: "AWS ECS ê°œë°œê¸° 2"
date: 2023-05-14
categories:
  - "ê°œë°œê¸°"
tags:
  - AWS
  - ECS
  - NestJS
image:
  path: /images/aws_ecs/Untitled 17.png
  thumbnail: /images/aws_ecs/Untitled 17.png
author: NOWIL
---

> ### Series
>
> 1. [aws-ecs-ê°œë°œê¸° - intro](/ê°œë°œê¸°/2023/05/14/aws-ecs-ê°œë°œê¸°-0.html)
> 2. [aws-ecs-ê°œë°œê¸° - 1](/ê°œë°œê¸°/2023/05/14/aws-ecs-ê°œë°œê¸°-1.html)
> 3. [aws-ecs-ê°œë°œê¸° - 2](/ê°œë°œê¸°/2023/05/14/aws-ecs-ê°œë°œê¸°-2.html)
> 4. [aws-ecs-ê°œë°œê¸° - 3](/ê°œë°œê¸°/2023/05/14/aws-ecs-ê°œë°œê¸°-3.html)

---

# í´ëŸ¬ìŠ¤í„° ìƒì„±í•˜ê¸°

ê·¸ëŸ¼ ì´ì œ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•  ECS í´ëŸ¬ìŠ¤í„°ë¥¼ ìƒì„±í•´ë³´ì£ .

(2023ë…„ë¶€í„° AWSì˜ ECS ì›¹ì½˜ì†”ì´ ìƒˆë¡œìš´ ë””ìì¸ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.)

### EC2 í‚¤í˜ì–´ ìƒì„±

ìš°ì„  ECS ì¸ìŠ¤í„´ìŠ¤ë¥¼ EC2ë¡œ í•  ì˜ˆì •ì´ê¸° ë•Œë¬¸ì— EC2 í‚¤í˜ì–´ë¥¼ ë¨¼ì € ìƒì„±í•˜ê² ìŠµë‹ˆë‹¤.

EC2 - ë„¤íŠ¸ì›Œí¬ ë° ë³´ì•ˆ - í‚¤í˜ì–´ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.

![Untitled](/images/aws_ecs/Untitled%2026.png)

![Untitled](/images/aws_ecs/Untitled%2027.png)

## IAM ì„¤ì •

### ecs ì •ì±… ìƒì„±

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "VisualEditor0",
      "Effect": "Allow",
      "Action": [
        "ecs:ListServicesByNamespace",
        "ecs:DiscoverPollEndpoint",
        "ecs:PutAccountSettingDefault",
        "ecs:CreateCluster",
        "ecs:DescribeTaskDefinition",
        "ecs:PutAccountSetting",
        "ecs:ListServices",
        "ecs:CreateCapacityProvider",
        "ecs:DeregisterTaskDefinition",
        "ecs:ListAccountSettings",
        "ecs:DeleteAccountSetting",
        "ecs:ListTaskDefinitionFamilies",
        "ecs:RegisterTaskDefinition",
        "ecs:ListTaskDefinitions",
        "ecs:CreateTaskSet",
        "ecs:ListClusters"
      ],
      "Resource": "*"
    },
    {
      "Sid": "VisualEditor1",
      "Effect": "Allow",
      "Action": "ecs:*",
      "Resource": [
        "arn:aws:ecs:*:{account_id}:cluster/*",
        "arn:aws:ecs:*:{account_id}:task/*/*",
        "arn:aws:ecs:*:{account_id}:capacity-provider/*",
        "arn:aws:ecs:*:{account_id}:task-set/*/*/*",
        "arn:aws:ecs:*:{account_id}:container-instance/*/*",
        "arn:aws:ecs:*:{account_id}:service/*/*",
        "arn:aws:ecs:*:{account_id}:task-definition/*:*"
      ]
    }
  ]
}
```

### ì‹ ë¢° ì •ì±… ìˆ˜ì •

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "",
      "Effect": "Allow",
      "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
      },
      "Action": "sts:AssumeRole"
    }
  ]
}
```

![Untitled](/images/aws_ecs/Untitled%2028.png)

![Untitled](/images/aws_ecs/Untitled%2029.png)

![Untitled](/images/aws_ecs/Untitled%2030.png)

![Untitled](/images/aws_ecs/Untitled%2031.png)

![Untitled](/images/aws_ecs/Untitled%2032.png)

### ECS í´ëŸ¬ìŠ¤í„° ìƒì„±

![Untitled](/images/aws_ecs/Untitled%2033.png)

![Untitled](/images/aws_ecs/Untitled%2034.png)

EC2ì˜ ì¸ìŠ¤í„´ìŠ¤ ìœ í˜•ì€ ì•„ë˜ ë§í¬ë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”. ì €ëŠ” ê°„ë‹¨í•œ ìƒ˜í”Œ í…ŒìŠ¤íŠ¸ìš© ì´ê¸° ë•Œë¬¸ì— t2.nanoë¥¼ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.

[https://aws.amazon.com/ko/ec2/instance-types/](https://aws.amazon.com/ko/ec2/instance-types/)

![Untitled](/images/aws_ecs/Untitled%2035.png)

íŠ¹íˆ **ì¸ìŠ¤í„´ìŠ¤ ë³„ vCPUì™€ ë©”ëª¨ë¦¬ì— ë”°ë¼ ì¶”í›„ Taskì˜ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” vCPUì™€ ë©”ëª¨ë¦¬ê°€ ë‹¬ë¼ì§€ë¯€ë¡œ** ë§¤ìš° ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

![Untitled](/images/aws_ecs/Untitled%2036.png)

![Untitled](/images/aws_ecs/Untitled%2037.png)

![Untitled](/images/aws_ecs/Untitled%2038.png)

# Task(ì‘ì—…) ì •ì˜í•˜ê¸°

ECSì—ì„œ TaskëŠ” Docker ì»¨í…Œì´ë„ˆ ì„¤ì •ì„ ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.

ì–´ë–¤ Docker ì´ë¯¸ì§€ë¥¼ ê°€ì§€ê³  Docker ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•˜ëŠ”ì§€ë¥¼ Taskì—ì„œ ì •ì˜í•  ìˆ˜ ìˆê³ , í•˜ë‚˜ì˜ Taskì— ì—¬ëŸ¬ ê°œì˜ Docker ì»¨í…Œì´ë„ˆ ì„¤ì •ì„ í•´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- ì‹œì‘ ìœ í˜• í˜¸í™˜ì„± ì„ íƒ(Fargate | EC2 | External)
- ì‚¬ìš©í•  ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ì„¤ì •
- ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìœ„í•´ ê°œë°©í•  í¬íŠ¸ ì„¤ì •
- CPU/ë©”ëª¨ë¦¬ ë¦¬ì†ŒìŠ¤ í• ë‹¹ ì„¤ì •
- ì‘ì—…ì˜ ì»¨í…Œì´ë„ˆì— ì‚¬ìš©í•  ë°ì´í„° ë³¼ë¥¨ ì„¤ì •

![Untitled](/images/aws_ecs/Untitled%2039.png)

![Untitled](/images/aws_ecs/Untitled%2040.png)

![Untitled](/images/aws_ecs/Untitled%2041.png)

## Dynamic Port Mapping í•˜ê¸°

![Untitled](/images/aws_ecs/Untitled%2042.png)

ë°°í¬ê°€ ë  ë•Œë§ˆë‹¤ í…ŒìŠ¤í¬ê°€ ìˆ˜ì •ë˜ë©° reverse-proxy-containerì˜ host portëŠ” ê³„ì†í•´ì„œ ë°”ë€” ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![Untitled](/images/aws_ecs/Untitled%2043.png)

ë”°ë¼ì„œ reverse-proxy-containerì˜ host portëŠ” 0ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ëª¨ë“  í¬íŠ¸ê°€ ê°€ëŠ¥í•˜ë„ë¡ í•´ì¤ë‹ˆë‹¤.

![Untitled](/images/aws_ecs/Untitled%2044.png)

ê·¸ë¦¬ê³  ECS í´ëŸ¬ìŠ¤í„°ë¥¼ í†µí•´ ìƒì„±ëœ EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ ë³´ì•ˆ ê·¸ë£¹ì˜ ì¸ë°”ìš´ë“œ ê·œì¹™ì— ëª¨ë“  TCP (0 - 65535)ë¥¼ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.

![Untitled](/images/aws_ecs/Untitled%2045.png)

í…ŒìŠ¤í¬ì˜ í¬ê¸°ëŠ” ìœ„ì—ì„œ ì„ íƒí•œ EC2ì˜ vCPUì™€ ë©”ëª¨ë¦¬ ì…ë ¥í•˜ë©´ ë©ë‹ˆë‹¤.

<aside>
â— vCPUì— ë”°ë¼ ì •ì˜í•  ìˆ˜ ìˆëŠ” ë©”ëª¨ë¦¬ê°’ë„ ì •í•´ì ¸ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ê°’ë“¤ì€ AWS ë ˆí¼ëŸ°ìŠ¤ë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”. ([AWS ë ˆí¼ëŸ°ìŠ¤](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_definition_parameters.html#task_size))

</aside>

![Untitled](/images/aws_ecs/Untitled%2046.png)

# ì„œë¹„ìŠ¤ ìƒì„±í•˜ê¸°

## ëŒ€ìƒ ê·¸ë£¹ ìƒì„±í•˜ê¸°

![Untitled](/images/aws_ecs/Untitled%2047.png)

<aside>
â— ECS clusterë¥¼ í†µí•´ ìƒì„±í•œ auto scaling groupì˜ EC2 ì¸ìŠ¤í„´ìŠ¤ì™€ VPCê°€ ê°™ì•„ì•¼ í•©ë‹ˆë‹¤.

</aside>

![Untitled](/images/aws_ecs/Untitled%2048.png)

![Untitled](/images/aws_ecs/Untitled%2049.png)

## ë¡œë“œ ë°¸ëŸ°ì„œ ìƒì„±í•˜ê¸°

![Untitled](/images/aws_ecs/Untitled%2050.png)

**Application Load Balancer ì„ íƒ**

![Untitled](/images/aws_ecs/Untitled%2051.png)

### ë¡œë“œë°¸ëŸ°ì„œ ë³´ì•ˆ ê·¸ë£¹ ìˆ˜ì •

![Untitled](/images/aws_ecs/Untitled%2052.png)

## ECS ì„œë¹„ìŠ¤ ìƒì„±í•˜ê¸°

![Untitled](/images/aws_ecs/Untitled%2053.png)

![Untitled](/images/aws_ecs/Untitled%2054.png)

<aside>
â— **ìµœì†Œ ì‹¤í–‰ ì‘ì—… ë¹„ìœ¨ê³¼ ìµœëŒ€ ì‹¤í–‰ ì‘ì—… ë¹„ìœ¨ì„ ê°ê° 0%ì™€ 100%ë¡œ í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.**
ë¡¤ë§ ì—…ë°ì´íŠ¸ ìœ í˜•ìœ¼ë¡œ ë°°í¬ê°€ ë˜ë©´ í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ë²„ì „ì„ ìµœì‹  ë²„ì „ìœ¼ë¡œ ë°”ê¾¸ëŠ”ë° ë§Œì•½ ìµœì†Œ ì‹¤í–‰ ì‘ì—… ë¹„ìœ¨ì„ 100%, ìµœëŒ€ ì‹¤í–‰ ì‘ì—… ë¹„ìœ¨ì„ 200%ìœ¼ë¡œ í•˜ê²Œë  ê²½ìš° **ë„ì»¤ì˜ portê°€ ì¤‘ë³µì´ ë˜ê¸° ë•Œë¬¸ì— ë°°í¬ê°€ ì§„í–‰ì´ ì•ˆë˜ë©° ì—ëŸ¬ê°€ ë°œìƒ**í•©ë‹ˆë‹¤.
ì°¸ê³  : [https://stackoverflow.com/questions/46018883/best-practice-for-updating-aws-ecs-service-tasks](https://stackoverflow.com/questions/46018883/best-practice-for-updating-aws-ecs-service-tasks)

</aside>

![Untitled](/images/aws_ecs/Untitled%2055.png)

ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰í•˜ë©´ ë°°í¬ê°€ ì•ˆë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì™œ ê·¸ëŸ´ê¹Œìš”?

í´ëŸ¬ìŠ¤í„°ì˜ ì»¨í…Œì´ë„ˆ ì¸ìŠ¤í„´ìŠ¤, í´ëŸ¬ìŠ¤í„°ë¥¼ ìƒì„±í•  ë•Œ ì„ ì–¸í•œ EC2ë¥¼ í™•ì¸í•´ë³´ë©´ ê°€ìš© ë©”ëª¨ë¦¬ê°€ 466mbì¸ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![Untitled](/images/aws_ecs/Untitled%2056.png)

í•˜ì§€ë§Œ ìš°ë¦¬ê°€ í…ŒìŠ¤í¬ë¥¼ ì •ì˜í•  ë•Œ í…ŒìŠ¤í¬ì˜ ë©”ëª¨ë¦¬ë¥¼ 500mbë¡œ ì„¤ì •í•˜ì˜€ì£ . ë”°ë¼ì„œ ìš°ë¦° í…ŒìŠ¤í¬ ë©”ëª¨ë¦¬ë¥¼ 466mbë³´ë‹¤ ì‘ê²Œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

>

![Untitled](/images/aws_ecs/Untitled%2057.png)

![Untitled](/images/aws_ecs/Untitled%2058.png)

í…ŒìŠ¤í¬ì˜ ë©”ëª¨ë¦¬ë¥¼ 450mbë¡œ ìˆ˜ì • í›„ ì´ì „ì˜ ë°°í¬ ì¤‘ì´ë˜ í…ŒìŠ¤í¬ëŠ” ì¤‘ì§€í•˜ê³  ECS ì„œë¹„ìŠ¤ë¥¼ ì—…ë°ì´íŠ¸í•´ë³´ê² ìŠµë‹ˆë‹¤.

![Untitled](/images/aws_ecs/Untitled%2059.png)

![Untitled](/images/aws_ecs/Untitled%2060.png)

![Untitled](/images/aws_ecs/Untitled%2061.png)

í™•ì¸í•´ë³´ë‹ˆ ë°°í¬ëŠ” ì§„í–‰ë˜ì§€ë§Œ ì‘ì—…ì´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.

![Untitled](/images/aws_ecs/Untitled%2062.png)

í™•ì¸í•´ë³´ë‹ˆ í…ŒìŠ¤í¬ ì •ì˜ ì¤‘ ì»¨í…Œì´ë„ˆ ì •ì˜ì—ì„œ reverse-proxy-containerì™€ example-app-containerê°„ì˜ ìˆœì„œë¥¼ ì •ì˜ì™€ ë§í¬ë¥¼ í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ í…ŒìŠ¤í¬ë¥¼ ìˆ˜ì •í•´ë³´ê² ìŠµë‹ˆë‹¤.

![Untitled](/images/aws_ecs/Untitled%2063.png)

![Untitled](/images/aws_ecs/Untitled%2064.png)

![Untitled](/images/aws_ecs/Untitled%2065.png)

ê·¸ë¦¬ê³  cloudwatchì—ì„œ ë¡œê·¸ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ Auto-configure CloudWatch Logsë¥¼ í™œì„±í™”í•˜ê² ìŠµë‹ˆë‹¤.

![Untitled](/images/aws_ecs/Untitled%2066.png)

example-app-containerì˜ í¬íŠ¸ ë§¤í•‘ë„ ìˆ˜ì •í•˜ê² ìŠµë‹ˆë‹¤.

![Untitled](/images/aws_ecs/Untitled%2067.png)

<aside>
â— í…ŒìŠ¤í¬ì˜ ìˆ˜ì •ì€ AWS ECS ì‹ ê·œ ì½˜ì†”ë³´ë‹¤ ì´ì „ ë²„ì „ì˜ ì½˜ì†”ì—ì„œ ë” ìì„¸í•˜ê²Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

</aside>

ê·¸ë¦¬ê³  ì´ì „ ë‹¨ê³„ì™€ ë˜‘ê°™ì´ ECS ì„œë¹„ìŠ¤ë¥¼ ì—…ë°ì´íŠ¸í–ˆìŠµë‹ˆë‹¤.

ì´ì œ ë§¤ìš° ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ” ECS ì„œë¹„ìŠ¤ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!

![Untitled](/images/aws_ecs/Untitled%2068.png)

# ECS í™˜ê²½ ë³€ìˆ˜ ì„¤ì •í•˜ê¸°

í•œë²ˆ Load balancersì˜ DNSë¡œ APIë¥¼ ìš”ì²­í•´ë³´ê² ìŠµë‹ˆë‹¤.

![Untitled](/images/aws_ecs/Untitled%2069.png)

localhostì—ì„œ ì‹¤í–‰í•œ ì»¨í…Œì´ë„ˆ ì•±ì—ì„œ ë‚˜ì™”ë˜ ì €ì ì´ë¦„ì´ ECSì—ì„œ ì‹¤í–‰í•œ ì»¨í…Œì´ë„ˆ ì•± ìƒì—ì„œëŠ” ë‚˜ì˜¤ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì €ìì˜ ì´ë¦„ì€ í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •í•˜ì˜€ëŠ”ë° ECS ì‘ì—… ì •ì˜ ë‹¨ê³„ì—ì„œ í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ì§€ ì•Šì•˜ê¸°ì— ë‹¹ì—°íˆ ì €ìì˜ ì´ë¦„ì€ ë‚˜ì˜¬ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.

ECSì—ì„œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì •ì˜í•˜ëŠ” ë°©ë²•ìœ¼ë¡œëŠ” í¬ê²Œ 4ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.

- ECS ì‘ì—… ì •ì˜ì— ë³€ìˆ˜ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
- ë³€ìˆ˜ë¥¼ Amazon Simple Storage Service(Amazon S3) ë²„í‚· ë‚´ë¶€ì˜ environmentFiles ê°ì²´ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.
- AWS Systems Manager Parameter Storeì— ë³€ìˆ˜ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
- AWS Secrets Manager ë‚´ë¶€ì— ë³€ìˆ˜ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

ì¶œì²˜ : [https://repost.aws/knowledge-center/ecs-task-environment-variables](https://repost.aws/knowledge-center/ecs-task-environment-variables)

ê·¸ ì¤‘ì— ì²«ë²ˆì§¸ëŠ” ì¶”í›„ github actionsë“±ì„ í†µí•´ ë°°í¬í•˜ëŠ” ê³¼ì •ì—ì„œ ì–´ë ¤ì›€ì´ ë§ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ AWS Secrets Managerë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ Amazon S3 ë²„í‚· ë‚´ë¶€ì˜ environmentFilesë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²• ì¤‘ì—ì„œ ì´ë²ˆì—” AWS Amazon S3 ë²„í‚· ë‚´ë¶€ì˜ environmentFilesë¥¼ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤.

- AWS Secrets Manager ì‚¬ìš©
  ## AWS Secrets Manager ì•”í˜¸ ìƒì„±
  ![Untitled](/images/aws_ecs/Untitled%2070.png)
  ![Untitled](/images/aws_ecs/Untitled%2071.png)
  ## IAM ê¶Œí•œ ì„¤ì •
  ìœ„ì—ì„œ ì‘ì—… ì •ì˜ë¥¼ ìœ„í•´ ìƒì„±í•œ **ecs-ec2-role** ì—­í• ì— ê¶Œí•œ ì •ì±…ì„ ì¶”ê°€í•˜ê² ìŠµë‹ˆë‹¤.
  ```json
  {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Effect": "Allow",
        "Action": ["secretsmanager:GetSecretValue"],
        "Resource": ["arn:aws:secretsmanager:{region}:{aws_account_id}:{secret:secret_name}"]
      }
    ]
  }
  ```
  ![Untitled](/images/aws_ecs/Untitled%2072.png)
  ![Untitled](/images/aws_ecs/Untitled%2073.png)
  ## **ì‘ì—… ì •ì˜ì˜ ìƒˆ ê°œì • ìƒì„±**
  ì»¨í…Œì´ë„ˆ ì •ì˜ í›„ ì„œë¹„ìŠ¤ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
  ![Untitled](/images/aws_ecs/Untitled%2074.png)
  ![Untitled](/images/aws_ecs/Untitled%2075.png)

## AWS Amazon S3 ë²„í‚· ìƒì„± í›„ environmentFiles ì €ì¥

![Untitled](/images/aws_ecs/Untitled%2076.png)

ë²„í‚·ì— env íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê¸° ìœ„í•´ì„œëŠ” íŒŒì¼ ì´ë¦„ì´ í•„ìˆ˜ì…ë‹ˆë‹¤.

## IAM ê¶Œí•œ ì„¤ì •

environmentFilesì„ ì €ì¥í•œ ë²„í‚·ì—ì„œ objectë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ ì •ì±…ì„ ìƒì„±í•©ë‹ˆë‹¤.

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": ["s3:*"],
      "Resource": ["arn:aws:s3:::ecs-sample-env/*"],
      "Condition": {
        "ArnLike": {
          "aws:SourceArn": "arn:aws:ecs:ap-northeast-2:{account_id}:*"
        },
        "StringEquals": {
          "aws:SourceAccount": "{account_id}"
        }
      }
    }
  ]
}
```

![Untitled](/images/aws_ecs/Untitled%2077.png)

## S3 ë²„í‚· ì •ì±… ìƒì„±

environmentFilesì€ ì„œë¹„ìŠ¤ì˜ ë³´ì•ˆì ìœ¼ë¡œ ì¤‘ìš”í•œ ë³€ìˆ˜ë“¤ì„ ì €ì¥í•œ íŒŒì¼ì…ë‹ˆë‹¤. ë”°ë¼ì„œ S3 ê°ì²´ë¡œ ì—…ë¡œë“œí•˜ì—¬ë„ í¼ë¸”ë¦­ìœ¼ë¡œ ì ‘ê·¼í•˜ë©´ ë‹¹ì—°íˆ ì•ˆë©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ íŠ¹ì • ì—­í• ì—ì„œë§Œ ì ‘ê·¼í•˜ê³  ì¼ë¶€ ì•¡ì…˜ë§Œ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

![Untitled](/images/aws_ecs/Untitled%2078.png)

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "PublicReadGetObject",
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::{account_id}:role/{ecs_task_role}"
      },
      "Action": "s3:*",
      "Resource": "arn:aws:s3:::ecs-sample-env/*"
    }
  ]
}
```

![Untitled](/images/aws_ecs/Untitled%2079.png)

ì°¸ê³  ìë£Œ : [https://inpa.tistory.com/entry/AWS-ğŸ“š-S3-ë²„í‚·-ìƒì„±-ì‚¬ìš©ë²•-ì‹¤ì „-êµ¬ì¶•](https://inpa.tistory.com/entry/AWS-%F0%9F%93%9A-S3-%EB%B2%84%ED%82%B7-%EC%83%9D%EC%84%B1-%EC%82%AC%EC%9A%A9%EB%B2%95-%EC%8B%A4%EC%A0%84-%EA%B5%AC%EC%B6%95)

## **ì‘ì—… ì •ì˜ì˜ ìƒˆ ê°œì • ìƒì„±**

í•´ë‹¹ env íŒŒì¼ì„ ì‚¬ìš©í•˜ëŠ” example-app-container ì»¨í…Œì´ë„ˆì˜ í™˜ê²½ íŒŒì¼ì— S3 ë²„í‚·ì— ì €ì¥í•œ environmentFileì˜ ARNì„ ì…ë ¥í•©ë‹ˆë‹¤.

![Untitled](/images/aws_ecs/Untitled%2080.png)

## ECS ì„œë¹„ìŠ¤ ì—…ë°ì´íŠ¸

ìƒˆë¡œ ìƒì„±ëœ ì‘ì—… ì •ì˜ ë²„ì „ìœ¼ë¡œ ECS ì„œë¹„ìŠ¤ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

![Untitled](/images/aws_ecs/Untitled%2081.png)

![Untitled](/images/aws_ecs/Untitled%2082.png)

ë°°í¬ê°€ ì™„ë£Œëœ í›„ APIë¥¼ í˜¸ì¶œí•´ ë³´ê² ìŠµë‹ˆë‹¤.

![Untitled](/images/aws_ecs/Untitled%2083.png)

í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •í•œ ì €ìì˜ ì´ë¦„ì´ ì •ìƒì ìœ¼ë¡œ ì¶œë ¥ë©ë‹ˆë‹¤!

ë‹¤ìŒ ì¥ì—” GitHubë¥¼ ì†ŒìŠ¤ ì½”ë“œ ë¦¬í¬ì§€í† ë¦¬ì—ì„œ GitHub Actionsë¥¼ ì‚¬ìš©í•˜ì—¬ Amazon ECSì— ë°°í¬ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìœ„í•œ CI/CD íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.
